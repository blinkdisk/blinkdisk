---
import DefaultLayout from "@marketing/layouts/DefaultLayout.astro";
import TableOfContents from "@marketing/components/TableOfContents.astro";
import RelatedTerms from "@marketing/components/RelatedTerms.astro";
import Button from "@marketing/components/Button.astro";
import { getCombinedStructuredData, categoryLabels } from "@marketing/data/glossary";
import { MARKETING_URL } from "astro:env/server";

type Heading = {
  depth: number;
  slug: string;
  text: string;
};

type RelatedTerm = {
  term: string;
  slug: string;
  shortAnswer: string;
};

type Props = {
  term: string;
  slug: string;
  question: string;
  shortAnswer: string;
  category: string;
  headings: Heading[];
  relatedTerms: RelatedTerm[];
  readingTime: number;
};

const {
  term,
  slug,
  question,
  shortAnswer,
  category,
  headings,
  relatedTerms,
  readingTime,
} = Astro.props;

const siteUrl = MARKETING_URL ?? "https://blinkdisk.com";
const ogImage = `/glossary/og/${slug}.png`;
const categoryLabel = categoryLabels[category] || category;

const termData = { term, slug, question, shortAnswer, category };
const structuredData = getCombinedStructuredData(termData, shortAnswer, siteUrl);
---

<DefaultLayout
  title={question}
  description={shortAnswer}
  og={{ title: question, image: ogImage }}
  structuredData={structuredData}
>
  <article class="pt-page pb-page mx-auto w-[90vw] max-w-3xl lg:max-w-4xl">
    <header class="mb-12">
      <div class="mb-6 flex flex-wrap items-center gap-4">
        <span class="bg-primary/10 text-primary rounded-full px-3 py-1 text-xs font-medium">
          {categoryLabel}
        </span>
        <span class="text-muted-foreground text-sm">{readingTime} min read</span>
      </div>

      <h1 class="text-foreground mb-6 text-3xl font-bold md:text-4xl">
        {question}
      </h1>

      <p class="text-foreground/80 text-lg leading-relaxed">
        {shortAnswer}
      </p>
    </header>

    <div class="flex flex-col gap-8 lg:flex-row">
      <div class="prose dark:prose-invert prose-img:rounded-xl prose-img:shadow min-w-0 max-w-none flex-1">
        <slot />
      </div>
      <aside class="hidden w-56 shrink-0 lg:block">
        <TableOfContents headings={headings} />
      </aside>
    </div>

    <RelatedTerms terms={relatedTerms} />

    <section class="cta-pattern relative mt-16 overflow-hidden rounded-2xl border bg-secondary px-8 py-12 text-center md:px-12 md:py-16">
      <div class="mb-6 flex items-center justify-center gap-4">
        <div class="bg-foreground/20 h-px w-8"></div>
        <span class="text-foreground/50 text-xs font-medium uppercase tracking-wider">
          Get started with BlinkDisk for free
        </span>
        <div class="bg-foreground/20 h-px w-8"></div>
      </div>

      <h2 class="text-foreground mb-4 text-2xl sm:text-3xl font-bold md:text-4xl whitespace-pre-wrap leading-tight">
        Ready to backup your files? <br class="hidden sm:block" />Download BlinkDisk for Free
      </h2>

      <p class="text-foreground/70 mx-auto mb-8 max-w-lg text-sm sm:text-base md:text-lg">
        BlinkDisk is a desktop application that lets you effortlessly create
        backup copies of all your important files.
      </p>

      <div class="flex items-center justify-center gap-4 flex-row">
        <Button href="/download" size="lg">
          Download for free
        </Button>
        <Button href="/glossary" size="lg" variant="outline" class="hidden sm:flex">
          Browse Glossary
        </Button>
      </div>
    </section>
  </article>
</DefaultLayout>

<style>
  .cta-pattern::before {
    content: "";
    position: absolute;
    inset: 0;
    background-image: radial-gradient(
      circle at center,
      oklch(0.4 0 0 / 0.35) 1px,
      transparent 1px
    );
    background-size: 24px 24px;
    pointer-events: none;
    mask-image: radial-gradient(ellipse at center, transparent 30%, black 100%);
    -webkit-mask-image: radial-gradient(
      ellipse at center,
      transparent 30%,
      black 100%
    );
  }

  :global(.dark) .cta-pattern::before {
    background-image: radial-gradient(
      circle at center,
      oklch(0.6 0 0 / 0.25) 1px,
      transparent 1px
    );
  }
</style>
