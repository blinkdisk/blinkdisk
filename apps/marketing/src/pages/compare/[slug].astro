---
import DefaultLayout from "@marketing/layouts/DefaultLayout.astro";
import ComparisonPageContent from "@marketing/components/compare/ComparisonPageContent.astro";
import { allTools } from "@config/comparison";

export const prerender = false;

const slug = Astro.params.slug;
if (!slug) return Astro.redirect("/404");

const toolsOrUndefined = slug.split("-vs-").map(slug => allTools.find(t => t.slug === slug));

if(toolsOrUndefined.some((tool) => tool === undefined) || toolsOrUndefined.length > 3) return Astro.redirect("/404")

const tools = toolsOrUndefined.filter((t): t is NonNullable<typeof t> => t !== undefined);

const title = `${tools.map(t => t.name).join(" vs ")}: A Detailed Comparison`;
const description = `Compare ${tools.length === 1 ? `${tools[0].name} and other backup software` : tools.length === 2 ? `${tools[0].name} and ${tools[1].name}` : `${tools[0].name}, ${tools[1].name} and ${tools[2].name}`} side by side. See features, pricing, privacy, platforms, storage options, and performance compared.`;

const structuredData = {
  "@context": "https://schema.org",
  "@type": "WebPage",
  name: title,
  description,
  mainEntity: {
    "@type": "ItemList",
    itemListElement: tools.map((tool, index) => ({
      "@type": "SoftwareApplication",
      position: index + 1,
      name: tool.name,
      url: tool.website,
      applicationCategory: "Backup Software",
    })),
  },
};
---

<DefaultLayout title={title} description={description} structuredData={structuredData}>
  <ComparisonPageContent tools={tools} title={title} description={description} />
</DefaultLayout>
