---
import BaseLayout from "@/layouts/BaseLayout.astro";
import Navigation from "@/components/Navigation.astro";
import Footer from "@/components/Footer.astro";
import PricingClient from "@/components/react/PricingClient";
import { plans } from "@config/plans";
import { FREE_SPACE_AVAILABLE } from "@config/space";

const siteUrl = import.meta.env.PUBLIC_LANDING_URL || "https://blinkdisk.com";
const freeStorageGB = Math.round(FREE_SPACE_AVAILABLE / 1000 / 1000 / 1000);

const planOffers = plans
  .filter((plan) => !plan.group)
  .map((plan) => {
    const monthlyPrice = plan.prices.find((p) => p.period === "MONTHLY");
    return {
      "@type": "Offer",
      name: `${plan.storageGB}GB Plan`,
      price: String(monthlyPrice?.amount || 0),
      priceCurrency: "USD",
      priceSpecification: {
        "@type": "UnitPriceSpecification",
        price: String(monthlyPrice?.amount || 0),
        priceCurrency: "USD",
        billingDuration: "P1M",
      },
      description: `${plan.storageGB}GB cloud storage`,
      url: `${siteUrl}/pricing`,
    };
  });

const productSchema = {
  "@context": "https://schema.org",
  "@type": "Product",
  name: "BlinkDisk Cloud Storage",
  description: "Secure cloud backup storage for BlinkDisk with end-to-end encryption.",
  brand: {
    "@type": "Brand",
    name: "BlinkDisk",
  },
  offers: [
    {
      "@type": "Offer",
      name: "Free Tier",
      price: "0",
      priceCurrency: "USD",
      description: `${freeStorageGB}GB free cloud storage`,
      url: `${siteUrl}/pricing`,
    },
    ...planOffers,
  ],
};
---

<BaseLayout
  title="Pricing"
  description="The plans & pricing for BlinkDisk. All powerful backup features are free, and you only pay for the storage you use."
  structuredData={productSchema}
>
  <Navigation />
  <PricingClient client:load />
  <Footer />
</BaseLayout>
